<app-header />
<div class="container mx-auto px-4 py-6">
  <!-- Header de la categoría -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">{{ categoryName }}</h1>
    <p class="text-gray-600">{{ filteredProducts.length }} productos encontrados</p>
  </div>

  <!-- Controles de vista y filtros -->
  <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6 bg-base-200 p-4 rounded-lg">
    <!-- Filtros -->
    <div class="flex flex-col sm:flex-row gap-4">
      <!-- Selector de rango de precios -->
      <div class="form-control">
        <label class="label">
          <span class="label-text font-medium">Precio</span>
        </label>
        <select 
          class="select select-bordered select-sm"
          [(ngModel)]="selectedPriceRange"
          (change)="onPriceRangeChange()">
          @for (range of priceRanges; track range.value) {
            <option [value]="range.value">{{ range.label }}</option>
          }
        </select>
      </div>

      <!-- Selector de ordenamiento -->
      <div class="form-control">
        <label class="label">
          <span class="label-text font-medium">Ordenar por</span>
        </label>
        <select 
          class="select select-bordered select-sm"
          [(ngModel)]="sortBy"
          (change)="onSortChange()">
          @for (option of sortOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
      </div>
    </div>

    <!-- Toggle de vista -->
    <div class="flex gap-2">
      <button 
        class="btn btn-sm"
        [ngClass]="{ 'btn-primary': isGridView, 'btn-outline': !isGridView }"
        (click)="toggleView()">
        <i-lucide [img]="gridIcon" class="h-4 w-4"></i-lucide>
        Grid
      </button>
      <button 
        class="btn btn-sm"
        [ngClass]="{ 'btn-primary': !isGridView, 'btn-outline': isGridView }"
        (click)="toggleView()">
        <i-lucide [img]="listIcon" class="h-4 w-4"></i-lucide>
        Lista
      </button>
    </div>
  </div>

  <!-- Lista/Grid de productos -->
  <div [ngClass]="{
    'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6': isGridView,
    'space-y-4': !isGridView
  }">
    @for (product of filteredProducts; track product.id) {
      <!-- Vista Grid -->
      <div 
        *ngIf="isGridView"
        class="card bg-base-100 shadow-md hover:shadow-lg transition-shadow cursor-pointer"
        (click)="goToProduct(product.id)">
        
        <figure class="px-4 pt-4 relative">
          <img 
            [src]="product.image" 
            [alt]="product.name"
            class="rounded-lg h-48 w-full object-cover">
          
          @if (product.discount) {
            <div class="badge badge-secondary absolute top-2 right-2">
              -{{ product.discount }}%
            </div>
          }
        </figure>

        <div class="card-body p-4">
          <h3 class="card-title text-base">{{ product.name }}</h3>
          <p class="text-sm text-gray-600 line-clamp-2">{{ product.description }}</p>
          
          <!-- Rating -->
          <div class="flex items-center gap-1 my-2">
            @for (star of generateStars(product.rating); track $index) {
              <i-lucide 
                [img]="starIcon" 
                [ngClass]="{ 'text-yellow-400': star, 'text-gray-300': !star }"
                class="h-4 w-4"></i-lucide>
            }
            <span class="text-sm text-gray-600 ml-1">({{ product.reviews }})</span>
          </div>
          
          <!-- Precio -->
          <div class="flex items-center gap-2">
            <span class="text-lg font-bold">S/ {{ product.price }}</span>
            @if (product.originalPrice) {
              <span class="text-sm text-gray-500 line-through">
                S/ {{ product.originalPrice }}
              </span>
            }
          </div>
        </div>
      </div>

      <!-- Vista Lista -->
      <div 
        *ngIf="!isGridView"
        class="card card-side bg-base-100 shadow-md hover:shadow-lg transition-shadow cursor-pointer"
        (click)="goToProduct(product.id)">
        
        <figure class="w-32 h-32 relative">
          <img 
            [src]="product.image" 
            [alt]="product.name"
            class="w-full h-full object-cover">
          @if (product.discount) {
            <div class="badge badge-secondary absolute top-2 right-2 text-xs">
              -{{ product.discount }}%
            </div>
          }
        </figure>

        <div class="card-body flex-row justify-between">
          <div class="flex-1">
            <h3 class="card-title">{{ product.name }}</h3>
            <p class="text-gray-600 text-sm mb-2">{{ product.description }}</p>
            
            <!-- Rating -->
            <div class="flex items-center gap-1">
              @for (star of generateStars(product.rating); track $index) {
                <i-lucide 
                  [img]="starIcon" 
                  [ngClass]="{ 'text-yellow-400': star, 'text-gray-300': !star }"
                  class="h-4 w-4"></i-lucide>
              }
              <span class="text-sm text-gray-600 ml-1">({{ product.reviews }})</span>
            </div>
          </div>

          <div class="flex flex-col justify-center items-end">
            <div class="text-right">
              <div class="text-lg font-bold">S/ {{ product.price }}</div>
              @if (product.originalPrice) {
                <div class="text-sm text-gray-500 line-through">
                  S/ {{ product.originalPrice }}
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    } @empty {
      <div class="col-span-full text-center py-12">
        <i-lucide [img]="filterIcon" class="h-16 w-16 mx-auto text-gray-400 mb-4"></i-lucide>
        <h3 class="text-lg font-medium text-gray-600 mb-2">No hay productos</h3>
        <p class="text-gray-500">No se encontraron productos en esta categoría con los filtros aplicados.</p>
      </div>
    }
  </div>
</div>

<app-footer />